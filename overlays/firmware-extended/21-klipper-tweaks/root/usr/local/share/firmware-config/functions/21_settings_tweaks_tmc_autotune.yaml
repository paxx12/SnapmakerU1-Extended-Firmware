settings:
  tweaks:
    label: Tweaks
    items:
      tmc_autotune:
        label: TMC AutoTune
        get_cmd:
          - bash
          - -c
          - test -f /oem/printer_data/config/extended/klipper/tmc_autotune.cfg && echo "enabled" || echo "disabled"
        options:
          enabled:
            label: Enabled
            confirm: "Enable TMC AutoTune? This optimizes TMC2240 driver settings for quieter operation and better performance. Warning: May cause motors to overheat if cooling is insufficient. Monitor temperatures during first use."
            cmd:
              - bash
              - -xc
              - |
                cp /usr/local/share/firmware-config/tweaks/klipper/tmc_autotune.cfg /oem/printer_data/config/extended/klipper/tmc_autotune.cfg &&
                echo "TMC AutoTune enabled. Restarting Klipper..." &&
                /etc/init.d/S60klipper restart
          disabled:
            label: Disabled
            cmd:
              - bash
              - -xc
              - |
                rm -f /oem/printer_data/config/extended/klipper/tmc_autotune.cfg &&
                echo "TMC AutoTune disabled. Restarting Klipper..." &&
                /etc/init.d/S60klipper restart
        default: disabled
