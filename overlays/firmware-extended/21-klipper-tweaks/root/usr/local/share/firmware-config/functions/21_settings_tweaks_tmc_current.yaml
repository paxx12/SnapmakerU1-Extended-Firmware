settings:
  tweaks:
    label: Tweaks
    items:
      tmc_reduce_current:
        label: 'TMC Reduced Current (<a href="http://snapmakeru1-extended-firmware.pages.dev/tweaks#tmc-reduced-current" target="_blank">link</a>)'
        get_cmd:
          - bash
          - -c
          - test -f /oem/printer_data/config/extended/klipper/tmc_current.cfg && echo "enabled" || echo "disabled"
        options:
          enabled:
            label: Enabled
            confirm: "Enable TMC Reduced Current? This lowers X/Y motor current from 1.2A to 1.0A for quieter operation and less heat. Warning: May cause skipped steps or layer shifts under heavy load. Monitor print quality after enabling."
            cmd:
              - bash
              - -xc
              - |
                cp -v /usr/local/share/firmware-config/tweaks/klipper/tmc_current.cfg /oem/printer_data/config/extended/klipper/tmc_current.cfg &&
                echo "TMC Reduced Current enabled. Restarting Klipper..." &&
                /etc/init.d/S60klipper restart
          disabled:
            label: Disabled
            cmd:
              - bash
              - -xc
              - |
                rm -vf /oem/printer_data/config/extended/klipper/tmc_current.cfg &&
                echo "TMC Reduced Current disabled. Restarting Klipper..." &&
                /etc/init.d/S60klipper restart
        default: disabled
